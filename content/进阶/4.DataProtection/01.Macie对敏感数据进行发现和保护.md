---
title: "Macie对敏感数据进行发现和保护"
chapter: false
weight: 41
tags:
  - advanced
---

## Macie对敏感数据进行发现和保护
Amazon Macie 是一项完全托管的数据安全和数据隐私服务，它利用机器学习和模式匹配来发现和保护 AWS 中的敏感数据。

随着组织管理越来越多的数据，大规模地识别和保护它们的敏感数据会变得越来越复杂、昂贵和耗时。Amazon Macie 可以大规模自动发现敏感数据，同时降低保护数据的成本。
Macie 会自动提供 Amazon S3 存储桶的清单，包括未加密的存储桶、可公开访问的存储桶以及与 AWS 账户共享的存储桶的列表。
Macie 将机器学习和模式匹配技术应用于您选择的存储桶，以识别敏感数据，并向您发出警报，例如个人身份信息 (PII)。 
您可以在 AWS 管理控制台中搜索和筛选 Macie 的警报或调查结果，并将其发送到 Amazon EventBridge（前称 Amazon CloudWatch Events），
以便轻松与现有工作流程或事件管理系统集成，或与 AWS 服务（例如 AWS Step Functions）结合使用，以执行自动修复操作。
这可以帮助您满足法规要求，例如《健康保险携带和责任法案》(HIPAA) 以及《通用数据隐私条例》(GDPR)。 

#### 启用Macie
1. 进入Macie控制台，并点击【启用Macie】按钮： https://ap-northeast-1.console.aws.amazon.com/macie/home?region=ap-northeast-1#getStarted
2. 设置Macie发现的信息所存放的S3 bucket，点击【立即配置】按钮： https://ap-northeast-1.console.aws.amazon.com/macie/home?region=ap-northeast-1#settings/repository-for-discovery-results
3. 在设置界面上，选择“创建存储桶”，存储桶的名字为<你的姓名拼音首字母>-macie-export-results，“KMS 密钥别名”选择“aws/s3”。点击【保存】按钮。
![](/images/4.DataProtection/macie_config.png)

#### 创建Macie任务
我们设置Macie的定时扫描任务，对<你的姓名拼音首字母>-macie-demo这个S3存储桶里的文件进行扫描。判断文件里是否包含中国大陆的个人身份证号、中国大陆的电话号码以及邮箱信息。具体设置如下：
1. 进入Macie控制台，创建“自定义数据标识符”： https://ap-northeast-1.console.aws.amazon.com/macie/home?region=ap-northeast-1#settings/custom-identifier/create
2. 在界面上，在“名称”一栏输入：china-id-format，表示这是一个检测中国大陆个人身份证号的规则。然后在“正则表达式”一栏输入：```[1-9]\d{5}(18|19|([23]\d))\d{2}((0[1-9])|(10|11|12))(([0-2][1-9])|10|20|30|31)\d{3}[0-9Xx]```

另外可以在“样本数据”一栏输入测试数据，然后点击【提交】按钮，可以看到该规则能够匹配一个身份证号。
```
test1
test2
310110200001010123
test3
```
确认设置的规则生效以后，点击【提交】按钮进行保存。
![](/images/4.DataProtection/macie_job1.png)
3. 同样的方式，创建检测中国大陆电话号码的规则。在“名称”一栏输入：china-phone-format，然后在“正则表达式”一栏输入：```(?:\+?86)?1(?:3\d{3}|5[^4\D]\d{2}|8\d{3}|7(?:[01356789]\d{2}|4(?:0\d|1[0-2]|9\d))|9[189]\d{2}|6[567]\d{2}|4(?:[14]0\d{3}|[68]\d{4}|[579]\d{2}))\d{6}```

在“样本数据”一栏输入测试数据，然后点击【提交】按钮，可以看到该规则能够匹配一个中国大陆的电话号码。
```
test1
test2
13412345678
test3
13812345678
```
![](/images/4.DataProtection/macie_job2.png)
4. 同样的方式，创建检测邮箱的规则。在“名称”一栏输入：email-format，然后在“正则表达式”一栏输入：```([a-zA-Z0-9_\-\.]+)@([a-zA-Z0-9]+)(\.[a-zA-Z0-9])+```

在“样本数据”一栏输入测试数据，然后点击【提交】按钮，可以看到该规则能够匹配一个邮箱的。
```
test1
test2
test@qq.com
test3
test@gmail.com
```
![](/images/4.DataProtection/macie_job3.png)
5. 进入Cloud9 IDE，准备一个测试文件，输入以下的测试内容：
```
cat << EOF > macietest.txt
test1
test2
310110201001010123
test3
13612345678
test4
test@gmail.com
test5
EOF
```
然后把该文件上传到S3的存储桶里：
```
aws s3 mb s3://<你的姓名拼音首字母>-macie-demo
aws s3 cp macietest.txt s3://<你的姓名拼音首字母>-macie-demo/
```
6. 进入Macie任务控制台，创建Macie任务： https://ap-northeast-1.console.aws.amazon.com/macie/home?region=ap-northeast-1#jobs/create?stepId=0
7. 在“步骤1 选择S3 存储桶”页面上，选择存储桶：<你的姓名拼音首字母>-macie-demo，点击【下一个】按钮。
8. 在“步骤2 检查 S3 存储桶”页面上，查看所需成本以后，点击【下一个】按钮。
9. 在“步骤3 范围”页面上，选择“一次性作业”。点击【下一个】按钮。
10. 在“步骤4 自定义数据标识符”页面上，把三个自定义数据标识符全都选中，点击【下一个】按钮。
11. 在“步骤5 名称和描述”页面上，“作业名称”输入：macie-demo-job，点击【下一个】按钮。
12. 在“步骤6 审核和创建”页面上，注意记录“敏感数据发现结果的存储库”所对应的S3存储桶，然后点击【提交】按钮。
13. 等待几分钟以后，作业任务会显示“完成”。然后点击“显示结果”，并选择“显示查找结果”，可以看到Macie任务发现了中国大陆身份证号、中国大陆手机号以及邮箱地址。
![](/images/4.DataProtection/macie_job4.png)



