---
title: "配置Security Hub"
chapter: false
weight: 25
tags:
  - advanced
---

## AWS Security Hub 是什么
AWS Security Hub 提供了您在 AWS 中的安全状态的全面视图，可帮助您检查环境是否符合安全行业标准和最佳实践。
Security Hub 跨各 AWS 账户、服务和受支持的第三方合作伙伴产品收集安全数据，帮助您分析安全趋势并确定最高优先级的安全问题。

## AWS Security Hub 的优势
**减少了收集结果并确定其优先次序的工作** \
Security Hub 减少了跨账户从集成的 AWS 服务和 AWS 合作伙伴产品中收集安全结果并确定其优先次序的工作。
    Security Hub 处理采用标准结果格式的结果数据，从而无需管理多种格式的结果数据。
    然后，Security Hub 将各提供商的结果相关联，以确定最重要结果的优先级。 \
**根据最佳实践和标准进行自动安全检查**  \
    根据 AWS 最佳实践和行业标准，Security Hub 自动运行连续的账户级配置和安全检查。
    Security Hub 提供这些检查的结果作为就绪分数，并确定需要注意的特定账户和资源。 \
**跨账户和提供商的结果的综合视图**  \
    Security Hub 将合并账户和提供商产品的安全结果，然后在 Security Hub 控制台上显示结果。
    这让您能够查看整体当前安全性状态，以发现趋势、识别潜在问题并采取必要的补救措施。 \
**自动修复结果的能力** \
    Security Hub 支持与 Amazon EventBridge 的集成。要自动修复特定结果，您可以定义在收到结果时要执行的自定义操作。
    例如，您可以配置自定义操作，将结果发送到票证系统或自动修复系统。

## 启用 Security Hub
1. 打开 Security Hub 控制台：https://ap-northeast-1.console.aws.amazon.com/securityhub/home?region=ap-northeast-1#/onboard。
2. 启用 Security Hub 需要开启 AWS Config 记录， 在“Enable AWS Config”部分点击【下载】按钮，下载 EnableAWSConfig.yml文件
3. 进入AWS CloudFormation 控制台：https://ap-northeast-1.console.aws.amazon.com/cloudformation/home?region=ap-northeast-1#/stacks/create/template
4. 选择 “模板已就绪”单选框，以及“上传模板文件”单选框，点击【选择文件】按钮，然后选择并上传上一步中下载的EnableAWSConfig.yml文件，点击【下一步】按钮。
5. 在“堆栈名称”一栏输入“securityhub”，其他选项保留缺省值，点击【下一步】按钮。
6. 在“配置堆栈选项”页面里，保持默认设置，点击【下一步】按钮。
7. 勾选“我确认，AWS CloudFormation 可能创建 IAM 资源。”复选框，点击【创建堆栈】按钮。
8. 等待3-5分钟以后，堆栈创建完毕，回到Security Hub 页面，点击【启用Security Hub】按钮。
9. 点击左侧菜单栏里的“摘要”或者“检测结果”查看系统发现的问题。
注意： 如果Config 刚刚启动，会出现CIS配置问题，这会在12小时后消失


## 配置自动发送检测结果
1. 进入 Amazon EventBridge 创建规则的控制台：https://ap-northeast-1.console.aws.amazon.com/events/home?region=ap-northeast-1#/rules/create
2. 为规则输入名称，比如securityhub-rule。
3. 在“定义模式”中,选择“事件模式”。
4. 在“事件匹配模式”中，选择“自定义模式”。
5. 复制以下示例模式，并将其粘贴到“事件模式”文本框中。 
    ```json
    {
    "source": [
        "aws.securityhub"
    ],
    "detail-type": [
        "Security Hub Findings - Imported"
    ]
    }
    ```
6. 点击【保存】以保存模式。 
7. 在“选择目标”部分里的“目标”下拉框中，选择“SNS主题”，然后在“主题”下拉框中，选择前面我们创建的SNS主题，比如这里是GuardDuty_to_Email。
8. 点击【创建】按钮。 
