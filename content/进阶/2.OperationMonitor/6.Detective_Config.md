---
title: "使用Detective呈现和分析数据"
chapter: false
weight: 26
tags:
  - advanced
---

## 什么是 AWS Detective
Amazon Detective使分析、调查和快速确定安全发现或可疑活动的根本原因变得容易。Detective自动从AWS资源收集日志数据。然后，它使用机器学习、统计分析和图论来帮助您可视化并进行更快、更有效的安全调查。
Detective预构建的数据聚合、摘要和上下文帮助您快速分析和确定可能的安全问题的性质和范围。Detective 保存了长达一年的历史事件数据。通过一组显示选定时间窗口内活动类型和数量变化的可视化，可以很容易地获得这些数据。Detective 把这些变化和警觉的发现联系起来。

## 启动 Detective
1. 启动Detective之前要确认 AWS GuardDuty 已经开启且超过48小时。开启步骤请参见前面文章
2. 通过 Detective 控制台启动Detective：https://ap-northeast-1.console.aws.amazon.com/detective/home?region=ap-northeast-1#enable
3. 检查当前用户是否有 "Attach IAM policy" 权限，否则，点击Copy IAM policy 并添加此policy 到当前用户权限中
4. 点击【Enable Amazon Detective】按钮。


## 通过 Detective 查看问题事件示例
1. Detective 可以用于分析系统中GuardDuty发现的问题, 以及系统日志中出现的可疑的活动。根据不同的活动， Detective 会给出不同的图示方便客户分析研究。
2. 打开GuardDuty，查看GuardDuty发现的问题，并拷贝该事件的Finding id. 如下图GuardDuty发现了某用户/角色出现了异常行为
![](/images/2.OperationMonitor/guardduty_finding.jpg)
3. 返回Detective 页面，点击左侧 Search, 在 Choose type中选择 GuardDuty finding，然后粘贴刚刚的finding id,点击右侧 Search
4. 点击列表中的 id 链接，进入详细页面
5. 在第一个tab的Overview中，系统用方框标示了可疑活动的时间段,可以看出在这段时间，api调用的失败率明显升高.并且能看到api调用的名称和调用地址
![](/images/2.OperationMonitor/detective_1.jpg)
6. 点击第二个tab，可以查看这些调用发出的物理位置，方便用户判断是否有账号泄漏的风险
![](/images/2.OperationMonitor/detective_2.jpg)