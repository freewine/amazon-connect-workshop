---
title: "部署云端网络基础架构"
chapter: false
weight: 31
tags:
  - beginner
---

## 按照最佳实践来部署一个云端VPC网络环境

包含的内容：

- 创建一个包含公有、私有子网的VPC
- 公有子网
    - 分别位于两个不同的可用区，该子网内的资源会暴露在互联网上，可被用户或客户端直接访问。用于部署NAT Gateway, 堡垒机，ELB负载均衡器等。
- 私有子网
    - 分别位于两个不同的可用区，该子网内的资源无法直接被互联网上的用户直接访问。用于部署Web应用服务器，中间件服务，数据库服务等无需直接暴露在互联网上的服务。
- 安全组
    - 充当EC2实例的虚拟防火墙，用于控制网络传入和传出流量。
- Network ACL
    - 网络访问控制列表，可用作防火墙来控制进出一个或多个子网的流量。
- 堡垒机
    - 使用Amazon Linux 2创建，用于对外进行远程管理使用。

详细架构如下图所示：

![](/images/3.NetworkSecurity/3.1.png)

实验步骤：

1. 创建Key pair并下载到本地，用于登录堡垒机
    打开EC2 Key pair控制台：https://ap-northeast-1.console.aws.amazon.com/ec2/v2/home?region=ap-northeast-1#KeyPairs:
	
    点击【创建密钥对】按钮
    * 在“名称”一栏输入密钥对名称，比如：<你的姓名拼音首字母>_secworkshop
    * 选择密钥格式，如果是用putty连接到EC2，则可以选择ppk，否则选择pem。
    点击【创建密钥对】按钮，并将密钥文件保存至电脑。

{{% notice note %}}
如果忘记下载密钥文件，则需要重新创建新的密钥文件并下载。
{{% /notice  %}}
2. 下载CloudFormation模板到本地电脑。
{{%attachments title="下载链接:" /%}}
3. 打开CloudFormation的控制台，并创建新的堆栈：
https://ap-northeast-1.console.aws.amazon.com/cloudformation/home?region=ap-northeast-1#/stacks/create/template
4. 在“准备模板”部分，保留缺省的“模板已就绪”选项。然后在"模板源"部分，选择"上传模板文件"单选框，点击【选择文件】按钮，并选择第一步中下载的CloudFormation yaml文件。点击【下一步】按钮。
输入以下的相关的参数，并点击【下一步】按钮。
* 堆栈名称：输入SecWorkshopVPC
* KeyPairName: 选择第一步创建的密钥对，比如<你的姓名拼音首字母>_secworkshop
* 其他选项按照默认即可，点击【下一步】按钮。
![](/images/3.NetworkSecurity/3.2.png)
在“配置堆栈选项”页面上，保留缺省值，并点击【下一步】按钮。
在“审核 SecWorkshopVPC”页面上，点击【创建堆栈】按钮，并等待此模板的创建执行完毕，此过程大概约3分钟左右。
![](/images/3.NetworkSecurity/3.3.png)
5. 查看资源
- 进入VPC控制台： https://ap-northeast-1.console.aws.amazon.com/vpc/home?region=ap-northeast-1#vpcs:
- 查看创建好的VPC，子网，路由表，安全组，Internet Gateway，NAT Gateway等资源。
- 进入EC2控制台： https://ap-northeast-1.console.aws.amazon.com/ec2/v2/home?region=ap-northeast-1#Instances:tag:Name=BastionInstance
- 把当前界面切换为英文界面，然后选中创建好的堡垒机EC2实例，并点击【连接】按钮，查看SSH登录方法。



