---
title: "部署示例应用程序并安全加固"
chapter: false
weight: 35
tags:
  - beginner
---

## 部署动手实验示例应用程序

本动手实验基于Wordpress作为示例应用程序，使用CloudFormation在您的实验环境中部署以下内容：

- 两个EC2实例作为Wordpress Web服务器，跨可用区部署
- RDS Aurora MySQL数据库实例，跨可用区部署
- Application Load Balancer负载均衡器
- Cloudfront CDN

在部署完毕示例应用程序以后，进行安全加固，使得ALB只允许CloudFront的流量进入，其他访问全都阻拦。

### 部署示例应用系统：

1. 下载CloudFormation模板文件
{{%attachments title="下载链接:" /%}}

2. 打开CloudFormation控制台：
https://ap-northeast-1.console.aws.amazon.com/cloudformation/home?region=ap-northeast-1#/stacks/create/template

点击【创建堆栈】，选择“**使用新资源(标准)**”， 在向导中的“**指定模板**”中选择“**上传模板文件**”单选框， 选择上一步骤下载的YAML文件，点击【下一步】。
![](/images/3.NetworkSecurity/3.5.2.png)
3. 在“指定堆栈详细信息”页面上：

- 堆栈名称：secworkshop-app
- DatabaseAdminUser: RDS Aurora实例的Master用户名，这里输入“wpadmin”
- DatabaseAdminPassword: RDS Aurora实例的Master用户密码，这里输入“wpadmin123”
- KeyPairName: 选择SSH Key，用于SSH登录Wordpress应用服务器
- PrivateApplicationSubnet1, PrivateApplicationSubnet2: 为应用系统选择部署的目标子网，选择两个不同的子网，以实现跨可用区高可用。在下拉列表里分别选择名称带有PrivateAppSubnet1和PrivateAppSubnet2的子网。
- PrivateDatabaseSubnet1, PrivateDatabaseSubnet2: 为RDS Aurora选择部署的目标子网，选择两个不同的子网，以实现跨可用区高可用。在下拉列表里选择名称带有PrivateDBSubnet1和PrivateDBSubnet2的子网。
- PublicSubnet1, PublicSubnet2: 为应用负载均衡器选择两个公有子网，在下拉列表里选择名称为PublicSubnet1，PublicSubnet2的子网。
- WorkshopVPC: 选择整个环境所在的VPC，在下拉列表里选择SecWorkshopVPC。
![](/images/3.NetworkSecurity/3.5.3.png)
![](/images/3.NetworkSecurity/3.5.4.png)
4. 配置堆栈选项页面中保持默认选项，点击【下一步】按钮，在审核页面中点击【创建堆栈】按钮开始资源的创建，整个过程大致约10分钟左右。
5. 当CloudFormation模板执行完成后，在输出选项中可找到应用的访问地址，RDS Aurora数据库信息等。
![](/images/3.NetworkSecurity/3.5.5.png)
输出内容：
- WordpressApplicationURL: 创建好的Wordpress应用地址
- LoadBalancerURL: 源站负载均衡器地址
- AuroraEndpoint: RDS Aurora数据库实例地址
- DatabaseMasterUsername: RDS Aurora数据库用户名
- DatabaseMasterUserPassword: RDS Aurora数据库用户密码

如需访问Wordpress后台管理页面，请访问：http://\<WordpressApplicationURL\>/wp-login.php
默认用户名和密码为：wpadmin/wpadmin123

### 设置ALB只放行CloudFront的流量
因为ALB设置为public，在公网上可以被直接访问，为了获得更高的安全，可以设置只放行从CloudFront发过来的流量，其他的流量都被ALB阻挡。详细设置可以参考：[配置 WAF 保护 Application Load Balancer]({{< ref "进阶/3.NetworkSecurity/15.WAF-for-ALB.md" >}})
