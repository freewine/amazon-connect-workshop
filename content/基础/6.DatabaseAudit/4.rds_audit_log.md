---
title: "对数据库启用审计日志"
chapter: false
weight: 61
tags:
  - beginner
---

本节将介绍以下内容

* [打开RDS Aurora数据库审计选项](#enable_aurora_audit_log)
* [打开RDS MySQL数据库审计选项](#enable_audit_log)

### 打开RDS Aurora数据库审计选项 {#enable_aurora_audit_log}

1. 因为wordpress数据库是Aurora MySQL数据库，修改该数据库的参数组的配置：
https://ap-northeast-1.console.aws.amazon.com/rds/home?region=ap-northeast-1#parameter-groups:

在过滤栏位上，输入“secworkshop”，然后点击“参数组操作”下拉菜单中的“编辑”选项。
![](/images/6.DatabaseAudit/aurora_parameter1.png)
2. 在参数的过滤栏位上，输入“server_audit_logging”，然后点击该参数复选框，并把该参数的值修改为“1”。点击【保存更改】。该参数的修改不需要重启数据库实例即可生效。
![](/images/6.DatabaseAudit/aurora_parameter2.png)
使用相同的方式，修改“server_audit_events”参数为“CONNECT, QUERY, QUERY_DCL, QUERY_DDL, QUERY_DML, TABLE”。
![](/images/6.DatabaseAudit/aurora_parameter3.png)
3. 进入wordpress数据库的主页对数据库的配置进行修改：
https://ap-northeast-1.console.aws.amazon.com/rds/home?region=ap-northeast-1#database:id=wordpress-cluster;is-cluster=true
4. 点击【修改】按钮，在“日志导出”部分，选中“审核日志”复选框。点击【继续】按钮。点击【修改集群】按钮。
![](/images/6.DatabaseAudit/aurora_audit_log_export1.png)
![](/images/6.DatabaseAudit/aurora_audit_log_export2.png)

### 打开RDS MySQL数据库审计选项 {#enable_audit_log}
如果是MySQL RDS，则需要通过选项组开启审计日志。

MySQL 有错误日志、慢查询日志、常规日志、审计日志和Binlog。错误日志是默认打开的，慢查询日志和审计日志需要修改参数组才能打开，审计日志需要修改选项组才能打开。

MySQL RDS | 打开方法 | 默认保存周期
--- | --- | ---
审计日志 | 修改选项组 | 文件达到1MiB后轮换，保留9个文件
错误日志 | 已默认打开 | 文件每小时轮换一次，保留24小时
慢查询日志 | 修改参数组 | mysql.slow_log表，每24小时轮换
常规日志 | 修改参数组 | mysql.general_log表，每24小时轮换
binlog | 执行存储过程 | 生成后尽快被删除，不保存

下面创建一个选项组开启审计日志。

**注意：更换选项组或修改审计选项不会造成RDS重启，但可能造成连接中断**

**审计插件只支持MySQL5.6和5.7 版本。**

1. 进入RDS控制台创建选项组：
https://ap-northeast-1.console.aws.amazon.com/rds/home?region=ap-northeast-1#create-option-group:

选择正确的**引擎版本**，创建选项组：
- 名称：mysql-5-7-modified
- 描述：mysql-5-7-modified
- 引擎：选择mysql
- 主要引擎版本：选择5.7
- 点击【创建】按钮。

![创建选项组](/images/6.DatabaseAudit/4.1.1.log-management-of-rds-mysql.png)
2. 进入上一步创建的选项组：
https://ap-northeast-1.console.aws.amazon.com/rds/home?region=ap-northeast-1#option-group-details:option-group-name=mysql-5-7-modified

在“选项”部分，点击【添加选项】按钮，给新创建的选项组增加**审计插件**选项。

默认：保留**9个**审计文件，每个文件大小**1MiB**。请根据业务情况修改。
在本次实验中，设置如下所示的选项，表示**100个**文件，每个**100MiB(共占10GiB)**。
设置完毕以后，点击【添加选项】按钮。

```config
SERVER_AUDIT_FILE_ROTATE_SIZE: 100000000
SERVER_AUDIT_FILE_ROTATIONS: 100
```
选项的含义和取值范围可参考[链接](https://docs.aws.amazon.com/zh_cn/AmazonRDS/latest/UserGuide/Appendix.MySQL.Options.AuditPlugin.html)
![添加选项](/images/6.DatabaseAudit/4.1.2.log-management-of-rds-mysql.png)
![添加选项](/images/6.DatabaseAudit/4.1.3.log-management-of-rds-mysql.png)
3. 修改RDS实例，从而使用新创建的选项组。
![绑定选项组](/images/6.DatabaseAudit/4.1.4.log-management-of-rds-mysql.png)
把**错误日志**和**审计日志**发送到Cloudwatch Log
![日志输出](/images/6.DatabaseAudit/4.1.5.log-management-of-rds-mysql.png)
确认修改的内容，**立即应用**
![立即应用](/images/6.DatabaseAudit/4.1.6.log-management-of-rds-mysql.png)
等数据库状态变为可用，变更就生效了。
