---
title: "在S3上安全的存储数据"
chapter: false
weight: 41

---

## 在S3上安全的存储数据

### 阻止用户删除S3上的文件
1. 确定要保护的存储桶
打开S3控制台，并找到前面创建的存储桶：<你的姓名拼音首字母>-secworkshop：https://s3.console.aws.amazon.com/s3/home?region=ap-northeast-1#
2. 为S3存储桶设置权限
在 Amazon S3控制台中，选择您在第 1 步中选择的存储桶。在存储桶详细页面中选择权限、存储桶策略，点击【编辑】按钮。将以下内容粘贴至存储桶策略编辑器中，点击【保存更改】按钮。
**注意：需要将*yourbucketname* 更改为 实际的S3 存储桶名称。**
```json 
{
    "Version": "2008-10-17",
    "Id": "PreventDeletePolicy",
    "Statement": [
        {
            "Sid": "PreventDelete",
            "Effect": "Deny",
            "Principal": {
                "AWS": "*"
            },
            "Action": [
                "s3:DeleteBucket",
                "s3:DeleteObject"
            ],
            "Resource": [
                "arn:aws:s3:::<你的姓名拼音首字母>-secworkshop",
                "arn:aws:s3:::<你的姓名拼音首字母>-secworkshop/*"
            ]
        }
    ]
}
```
如果已经存在存储桶策略，则把上面的内容拷贝进去，如下所示：
```
{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Sid": "AWSCloudTrailAclCheck20150319",
            "Effect": "Allow",
            "Principal": {
                "Service": "cloudtrail.amazonaws.com"
            },
            "Action": "s3:GetBucketAcl",
            "Resource": "arn:aws:s3:::<你的姓名拼音首字母>-secworkshop"
        },
        {
            "Sid": "AWSCloudTrailWrite20150319",
            "Effect": "Allow",
            "Principal": {
                "Service": "cloudtrail.amazonaws.com"
            },
            "Action": "s3:PutObject",
            "Resource": "arn:aws:s3:::<你的姓名拼音首字母>-secworkshop/AWSLogs/710409875639/*",
            "Condition": {
                "StringEquals": {
                    "s3:x-amz-acl": "bucket-owner-full-control"
                }
            }
        },
        {
            "Sid": "PreventDelete",
            "Effect": "Deny",
            "Principal": {
                "AWS": "*"
            },
            "Action": [
                "s3:DeleteBucket",
                "s3:DeleteObject"
            ],
            "Resource": [
                "arn:aws:s3:::<你的姓名拼音首字母>-secworkshop",
                "arn:aws:s3:::<你的姓名拼音首字母>-secworkshop/*"
            ]
        }
    ]
}
```
3. 删除测试
尝试对该存储桶或存储桶中的对象进行删除时，会返回拒绝删除的错误。

#### 阻止S3存储桶被公开访问
1. 账户级别的阻止公网访问设置

点击S3控制台中的**阻止公有访问**账户设置，将其全部启用，则当前AWS账户下的AWS存储桶无法提供对外公共访问。如需要将某存储桶中的对象设置为对外公共访问，则需要关闭账户级别的**阻止公有访问**设置。

![](/images/4.DataProtection/4.1.2.png)
2. 存储桶级别的阻止公有访问设置

在 Amazon S3控制台中，选择您需要设置的存储桶。在存储桶详细页面中选择权限， 在阻止公有访问(存储桶设置)中将其全部启用，则当前存储桶下的对象无法设置为对外公共访问。如需通过存储桶策略来设置对外公共访问，则需要将此选项关闭。

![](/images/4.DataProtection/4.1.3.png)