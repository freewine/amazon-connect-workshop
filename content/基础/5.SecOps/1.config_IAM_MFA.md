---
title: "配置IAM+MFA"
chapter: false
weight: 51
tags:
  - beginner
---

### IAM用户

当创建完AWS的账号后，我们可以使用邮箱登录AWS控制台，这个邮箱称之为根账号。使用根账号登录之后，可以创建称之为"IAM用户"的用户。一个AWS的账号中，可以拥有多个IAM用户，用来给组织中的不同角色使用，每个IAM用户都有自己的密码，用来访问AWS控制台。而为了保证账户安全，AWS的最佳实践推荐为根账号以及IAM用户绑定MFA，绑定MFA之后，我们可以要求每一个IAM用户在登录的时候配合MFA验证，这样可以保护AWS账号里面的资源，避免意外泄露密码，导致安全事故。

### 实验内容
在这个动手实验中，我们会实践如何创建IAM用户，并且绑定MFA到IAM用户。

### 实验一. 创建IAM用户

1. 登录AWS控制台，之后在选项卡中输入【IAM】，然后跳转到IAM的控制台界面，如下图所示：
![IAM控制台](/images/5.SecOps/IAM_console.png)
2. 在IAM控制台界面，选择左侧【用户】选项
![IAM用户](/images/5.SecOps/IAM_console_user.jpg)
3. 进入用户选项后，选择【添加用户】
![添加用户](/images/5.SecOps/IAM_console_add_user.png)
4. 在进入用户创建界面后，可以选择配置初始密码，或者由系统生成密码。为了保证IAM用户的密码保密，可以要求创建的IAM用户在下次登录时创建新的密码。
![添加用户](/images/5.SecOps/IAM_console_add_user_step_1.png)
5. 为用户选择权限，我们可以直接附加现有的托管策略，比如在本次实验中，我们给予Administrator的访问权限。我们也可以根据用户的不同职责给予精细的访问控制权限。
![添加用户](/images/5.SecOps/IAM_console_add_user_step_2.png)
6. 为用户打上标签，标签可以作为信息描述，或者用来跟踪，控制权限使用，在这里，我们只添加以下信息：
![添加用户](/images/5.SecOps/IAM_console_add_user_step_3.png)
7. 通过审核后，创建用户
![添加用户](/images/5.SecOps/IAM_console_add_user_step_4.png)
![添加用户](/images/5.SecOps/IAM_console_add_user_step_5.png)
8. 创建完成之后，我们可以在IAM用户列表中看到新创建的IAM用户。
![添加用户](/images/5.SecOps/IAM_console_add_user_step_6.png)
9. 现在，我们需要登出AWS控制台，然后使用IAM用户登录，使用IAM用户登录的时候，我们需要指导自己的账号的数字ID，通常他是一个12位的数字，这个数字ID可以在AWS控制台的右上角找到，如下图所示：
![添加用户](/images/5.SecOps/IAM_console_account_id.png)
10. 记录下AWS帐号的数字ID之后，登出控制台，然后再次进入登录页面。
![用户登录](/images/5.SecOps/IAM_console_IAM_login.png)
11. 使用之前创建的用户名和密码登录。
![用户登录](/images/5.SecOps/IAM_console_IAM_login_page.png)
12. 因为配置需要修改密码，第一次登录后，会要求修改密码，修改成功后，登录成功。
![用户登录](/images/5.SecOps/IAM_console_IAM_change_password.png)

### 实验二，绑定MFA设备
本次实验中，我们会为实验一中创建的用户，绑定一个MFA设备，为IAM用户登录开启二次验证，保证账号安全，实验中使用的MFA设备可以在APP Store中下载：
![APP Store下载MFA](/images/5.SecOps/MFA.png)

1. 登录成功后，IAM用户使用者可以为此用户绑定MFA，按照步骤1，2，进入IAM控制台，找到IAM用户，在本实验例子中，用户是【security_user】，点击用户之后，选择【安全证书】，在登录凭证中找到【已分配MFA设备】，点击管理，开始绑定MFA设备
![绑定MFA](/images/5.SecOps/IAM_console_add_MFA.png)
2. 在跳出来的窗口中，选择我们拥有的MFA设备，在本次实验中，我们使用的是【虚拟MFA设备】,使用的设备需要在APP Store中下载。
![绑定MFA](/images/5.SecOps/IAM_console_add_MFA_virtual_MFA.png)
3. 点击继续之后，弹出新的窗口，打开虚拟MFA，扫描二维码，在虚拟MFA中会有一个关联AWS账号的选项，然后连续输入两次MFA设备中的两次代码，即可正确绑定MFA设备和AWS账号。
![绑定MFA](/images/5.SecOps/IAM_console_add_MFA_virtual_MFA_1.png)
![绑定MFA](/images/5.SecOps/IAM_console_add_MFA_virtual_MFA_2.png)
4. 分配MFA成功后，登出控制台，再次登录，发现需要验证MFA代码。
![绑定MFA](/images/5.SecOps/IAM_console_add_MFA_virtual_MFA_3.png)

### 实验总结
MFA除了在用户登录中使用以外，还可以配置MFA在以下场景
1. 跨账户委派的 MFA 保护
2. 当前账户中 API 操作访问的 MFA 保护，具体可以参考[配置受 MFA 保护的 API 访问](https://docs.aws.amazon.com/zh_cn/IAM/latest/UserGuide/id_credentials_mfa_configure-api-require.html)
3. 拥有基于资源的策略的资源的 MFA 保护


